---
title: "Rproject_semesterproj"
author: "Lisa Wahlen"
date: "`r Sys.Date()`"
output: html_document
---

## Load Libraries

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr) # to import tabular data (e.g. csv)
library(dplyr) # to manipulate (tabular) data
library(ggplot2) # to visualize data
library(sf) # to handle spatial vector data
library(terra) # To handle raster data
library(lubridate) # To handle dates and times
library(SimilarityMeasures)
library(RColorBrewer)
library(tmap)

mycolors4 <- brewer.pal(4, "BrBG")
```

## Read Data

```{r}
posmo <- read_csv("data/posmo_2023-05-18T00_00_00+02_00-2023-05-18T23_59_59+02_00.csv")
```

Evtl. könnte man die Daten auf die AV-Daten legen. So kann man dann alle Trajectories löschen, welche sich auf einer Strasse befinden.

```{r}
posmo <- st_as_sf(posmo, coords = c("lon_x","lat_y"), crs = 4326) |>
  st_transform(2056)

head(posmo)

posmo_coordinates <- st_coordinates(posmo)

posmo <- cbind(posmo, posmo_coordinates)

posmo_transport <- select(posmo, -c("weekday", "place_name", "user_id"))
posmo <- select(posmo, -c("weekday", "place_name", "transport_mode", "user_id"))
```

## first plots, visualization
```{r}
# overview datapoints
ggplot(posmo, aes(x=X, y=Y))+
  geom_point()+
  coord_fixed()

# overview transport mode
ggplot(posmo_transport, aes(x=X, y=Y, color=transport_mode))+
  geom_point()+
  coord_fixed()

# overview with map background
tmap_mode("view")
tm_shape(posmo_transport)+
  tm_dots("transport_mode")

```
most of the trajectory is labelled with the transport mode "car". The loop located in the south of the trajectory shows the part where Lisa went downhill-biking in Diemtigtal, Allmiried. Most of that section is labelled as "car", wherease some points are labelled as "walk". We now want to try to find out some criteria in order to be able to isolate that downhill biking part and label it as "downhill biking"

## pattern

how to isolate downhill biking pattern?

things to try
- setting speed threshold
- compare to street map
- compare to elevation model (topography)
- segmentation into segments expressing different sinuosity (Laube, computational movement analysis, 2014)
```{r}
# calculate distance between points d_plusx for distance

posmo_transport |> 
  mutate(
    d_plus1 = sqrt((lead(X)-X)^2 + (lead(Y)-Y)^2),
    d_plus2 = sqrt((lead(X,2)-X)^2 + (lead(Y,2)-Y)^2), # new offset of 2 in function lead()
    d_minus1 = sqrt((lag(X)-X)^2 + (lag(Y)-Y)^2),
    d_minus2 = sqrt((lag(X,2)-X)^2 + (lag(Y,2)-Y)^2),
    t_plus1 = difftime(lead(datetime), datetime),
    t_plus2 = difftime(lead(datetime, 2), datetime),
    t_minus1 = difftime(lag(datetime), datetime),
    t_minus2 = difftime(lag(datetime, 2), datetime),
    s_plus1 = t_plus1/d_plus1 # s for speed
  )

# calculate time between points
```

